#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
33m2 ìˆ˜ë„ê¶Œ(ì„œìš¸/ì¸ì²œ/ê²½ê¸°) ì˜¤í”¼ìŠ¤í…”&ì•„íŒŒíŠ¸ í¬ë¡¤ë§ - ì™„ì „í•œ ì½”ë“œ
ì‹¤í–‰: python metropolitan_crawler_complete.py
"""
import time, random, json
from datetime import datetime
from typing import Dict, List, Set, Tuple
import pandas as pd
import httpx


# ---- ì„¤ì • ----
SEARCH_URL = "https://33m2.co.kr/app/room/search"
OUTPUT_FILE = "metropolitan_officetel_complete.csv"

# ë”œë ˆì´ ì„¤ì • (ì°¨ë‹¨ ë°©ì§€)
REQUEST_DELAY_MIN = 2.5
REQUEST_DELAY_MAX = 5
BATCH_SIZE = 100

# ìˆ˜ë„ê¶Œ ì „ì²´ í–‰ì •êµ¬ì—­ (66ê°œ ê¸°ì´ˆìì¹˜ë‹¨ì²´)
METROPOLITAN_AREAS = {
    # ì„œìš¸íŠ¹ë³„ì‹œ 25ê°œ ìì¹˜êµ¬
    "ì„œìš¸íŠ¹ë³„ì‹œ": [
        "ê°•ë‚¨êµ¬",
        "ê°•ë™êµ¬",
        "ê°•ë¶êµ¬",
        "ê°•ì„œêµ¬",
        "ê´€ì•…êµ¬",
        "ê´‘ì§„êµ¬",
        "êµ¬ë¡œêµ¬",
        "ê¸ˆì²œêµ¬",
        "ë…¸ì›êµ¬",
        "ë„ë´‰êµ¬",
        "ë™ëŒ€ë¬¸êµ¬",
        "ë™ì‘êµ¬",
        "ë§ˆí¬êµ¬",
        "ì„œëŒ€ë¬¸êµ¬",
        "ì„œì´ˆêµ¬",
        "ì„±ë™êµ¬",
        "ì„±ë¶êµ¬",
        "ì†¡íŒŒêµ¬",
        "ì–‘ì²œêµ¬",
        "ì˜ë“±í¬êµ¬",
        "ìš©ì‚°êµ¬",
        "ì€í‰êµ¬",
        "ì¢…ë¡œêµ¬",
        "ì¤‘êµ¬",
        "ì¤‘ë‘êµ¬",
    ],
    # ì¸ì²œê´‘ì—­ì‹œ 8êµ¬ 2êµ°
    "ì¸ì²œê´‘ì—­ì‹œ": [
        "ì¤‘êµ¬",
        "ë™êµ¬",
        "ë¯¸ì¶”í™€êµ¬",
        "ì—°ìˆ˜êµ¬",
        "ë‚¨ë™êµ¬",
        "ë¶€í‰êµ¬",
        "ê³„ì–‘êµ¬",
        "ì„œêµ¬",
        "ê°•í™”êµ°",
        "ì˜¹ì§„êµ°",
    ],
    # ê²½ê¸°ë„ 28ì‹œ 3êµ°
    "ê²½ê¸°ë„": [
        "ìˆ˜ì›ì‹œ",
        "ì„±ë‚¨ì‹œ",
        "ì˜ì •ë¶€ì‹œ",
        "ì•ˆì–‘ì‹œ",
        "ë¶€ì²œì‹œ",
        "ê´‘ëª…ì‹œ",
        "í‰íƒì‹œ",
        "ë™ë‘ì²œì‹œ",
        "ì•ˆì‚°ì‹œ",
        "ê³ ì–‘ì‹œ",
        "ê³¼ì²œì‹œ",
        "êµ¬ë¦¬ì‹œ",
        "ë‚¨ì–‘ì£¼ì‹œ",
        "ì˜¤ì‚°ì‹œ",
        "ì‹œí¥ì‹œ",
        "êµ°í¬ì‹œ",
        "ì˜ì™•ì‹œ",
        "í•˜ë‚¨ì‹œ",
        "ìš©ì¸ì‹œ",
        "íŒŒì£¼ì‹œ",
        "ì´ì²œì‹œ",
        "ì•ˆì„±ì‹œ",
        "ê¹€í¬ì‹œ",
        "í™”ì„±ì‹œ",
        "ê´‘ì£¼ì‹œ",
        "ì–‘ì£¼ì‹œ",
        "í¬ì²œì‹œ",
        "ì—¬ì£¼ì‹œ",
        "ì—°ì²œêµ°",
        "ê°€í‰êµ°",
        "ì–‘í‰êµ°",
    ],
}

# ë§¤ë¬¼ ë°€ì§‘ ì§€ì—­ë³„ ì„¸ë¶„í™” (ì£¼ìš” ë„ì‹œë§Œ)
DISTRICT_SUBDIVISIONS = {
    "ê°•ë‚¨êµ¬": [
        "ê°œí¬ë™",
        "ë…¼í˜„ë™",
        "ëŒ€ì¹˜ë™",
        "ë„ê³¡ë™",
        "ì‚¼ì„±ë™",
        "ì„¸ê³¡ë™",
        "ì‹ ì‚¬ë™",
        "ì••êµ¬ì •ë™",
        "ì—­ì‚¼ë™",
        "ì¼ì›ë™",
        "ì²­ë‹´ë™",
        "ìˆ˜ì„œë™",
        "ìœ¨í˜„ë™",
        "ìê³¡ë™",
    ],
    "ê°•ë™êµ¬": [
        "ê°•ì¼ë™",
        "ê³ ë•ë™",
        "ê¸¸ë™",
        "ë‘”ì´Œë™",
        "ëª…ì¼ë™",
        "ìƒì¼ë™",
        "ì„±ë‚´ë™",
        "ì•”ì‚¬ë™",
        "ì²œí˜¸ë™",
        "ë‘”ì´Œì œ1ë™",
        "ë‘”ì´Œì œ2ë™",
    ],
    "ê°•ë¶êµ¬": ["ë¯¸ì•„ë™", "ë²ˆë™", "ìˆ˜ìœ ë™", "ìš°ì´ë™", "ì¸ìˆ˜ë™"],
    "ê°•ì„œêµ¬": [
        "ê°€ì–‘ë™",
        "ê°œí™”ë™",
        "ê³µí•­ë™",
        "ê³¼í•´ë™",
        "ë‚´ë°œì‚°ë™",
        "ë“±ì´Œë™",
        "ë§ˆê³¡ë™",
        "ë°©í™”ë™",
        "ì—¼ì°½ë™",
        "ì˜¤ê³¡ë™",
        "ì˜¤ì‡ ë™",
        "ì™¸ë°œì‚°ë™",
        "í™”ê³¡ë™",
    ],
    "ê´€ì•…êµ¬": [
        "ë‚™ì„±ëŒ€ë™",
        "ë‚œê³¡ë™",
        "ë‚œí–¥ë™",
        "ë‚¨í˜„ë™",
        "ëŒ€í•™ë™",
        "ë¯¸ì„±ë™",
        "ë³´ë¼ë§¤ë™",
        "ì‚¼ì„±ë™",
        "ì„œë¦¼ë™",
        "ì„œì›ë™",
        "ì„±í˜„ë™",
        "ì‹ ë¦¼ë™",
        "ì‹ ì‚¬ë™",
        "ì‹ ì›ë™",
        "ì€ì²œë™",
        "ì¡°ì›ë™",
        "ì¤‘ì•™ë™",
        "ì²­ë£¡ë™",
        "ì²­ë¦¼ë™",
        "í–‰ìš´ë™",
        "ì¸í—Œë™",
    ],
    "ê´‘ì§„êµ¬": ["ê´‘ì¥ë™", "êµ°ìë™", "ëŠ¥ë™", "ìì–‘ë™", "ì¤‘ê³¡ë™", "í™”ì–‘ë™", "êµ¬ì˜ë™"],
    "êµ¬ë¡œêµ¬": [
        "ê°€ë¦¬ë´‰ë™",
        "ê°œë´‰ë™",
        "ê³ ì²™ë™",
        "êµ¬ë¡œë™",
        "ê¶ë™",
        "ìˆ˜ê¶ë™",
        "ì˜¤ë¥˜ë™",
        "ì˜¨ìˆ˜ë™",
        "ì‹ ë„ë¦¼ë™",
        "í•­ë™",
        "ì²œì™•ë™",
    ],
    "ê¸ˆì²œêµ¬": ["ê°€ì‚°ë™", "ë…ì‚°ë™", "ì‹œí¥ë™"],
    "ë…¸ì›êµ¬": ["ê³µë¦‰ë™", "ìƒê³„ë™", "ì›”ê³„ë™", "ì¤‘ê³„ë™", "í•˜ê³„ë™"],
    "ë„ë´‰êµ¬": ["ë°©í•™ë™", "ìŒë¬¸ë™", "ë„ë´‰ë™", "ì°½ë™"],
    "ë™ëŒ€ë¬¸êµ¬": [
        "ë‹µì‹­ë¦¬ë™",
        "ì¥ì•ˆë™",
        "ì „ë†ë™",
        "ì œê¸°ë™",
        "ì²­ëŸ‰ë¦¬ë™",
        "íšŒê¸°ë™",
        "íœ˜ê²½ë™",
        "ì´ë¬¸ë™",
        "ìš©ë‘ë™",
        "ì‹ ì„¤ë™",
    ],
    "ë™ì‘êµ¬": [
        "ë…¸ëŸ‰ì§„ë™",
        "ëŒ€ë°©ë™",
        "ë™ì‘ë™",
        "ë³¸ë™",
        "ì‚¬ë‹¹ë™",
        "ìƒë„ë™",
        "ì‹ ëŒ€ë°©ë™",
        "í‘ì„ë™",
        "ìƒë„1ë™",
    ],
    "ë§ˆí¬êµ¬": [
        "ê³µë•ë™",
        "ë…¸ê³ ì‚°ë™",
        "ë‹¹ì¸ë™",
        "ë„í™”ë™",
        "ë™êµë™",
        "ë™ì‚°ë™",
        "ë§ì›ë™",
        "ìƒìˆ˜ë™",
        "ì„œêµë™",
        "ì‹ ê³µë•ë™",
        "ì‹ ìˆ˜ë™",
        "ì•„í˜„ë™",
        "ì—°ë‚¨ë™",
        "ì—¼ë¦¬ë™",
        "ìš©ê°•ë™",
        "ì¤‘ë™",
        "ì°½ì „ë™",
        "í† ì •ë™",
        "í•©ì •ë™",
        "í˜„ì„ë™",
        "ì„±ì‚°ë™",
        "ë§ˆí¬ë™",
        "ëŒ€í¥ë™",
        "êµ¬ìˆ˜ë™",
        "í•˜ì¤‘ë™",
        "ìƒì•”ë™",
    ],
    "ì„œëŒ€ë¬¸êµ¬": [
        "ë‚¨ê°€ì¢Œë™",
        "ë¶ê°€ì¢Œë™",
        "ë¶ì•„í˜„ë™",
        "ì‹ ì´Œë™",
        "ì—°í¬ë™",
        "ì˜ì²œë™",
        "ì˜¥ì²œë™",
        "ì²œì—°ë™",
        "ì¶©ì •ë¡œë™",
        "í•©ë™",
        "í˜„ì €ë™",
        "í™ì€ë™",
        "í™ì œë™",
        "ëŒ€í˜„ë™",
        "ë¯¸ê·¼ë™",
        "ëŒ€ì‹ ë™",
        "ë´‰ì›ë™",
        "ì°½ì²œë™",
        "ëƒ‰ì²œë™",
        "ì˜¥ì²œë™",
    ],
    "ì„œì´ˆêµ¬": [
        "ë‚´ê³¡ë™",
        "ë…¼í˜„ë™",
        "ë°˜í¬ë™",
        "ë°©ë°°ë™",
        "ì„œì´ˆë™",
        "ì‹ ì›ë™",
        "ì–‘ì¬ë™",
        "ì—¼ê³¡ë™",
        "ìš°ë©´ë™",
        "ì ì›ë™",
    ],
    "ì„±ë™êµ¬": [
        "ê¸ˆí˜¸ë™1ê°€",
        "ê¸ˆí˜¸ë™2ê°€",
        "ê¸ˆí˜¸ë™3ê°€",
        "ê¸ˆí˜¸ë™4ê°€",
        "ë§ˆì¥ë™",
        "ì‚¬ê·¼ë™",
        "ìƒì™•ì‹­ë¦¬ë™",
        "ì„±ìˆ˜ë™1ê°€",
        "ì„±ìˆ˜ë™2ê°€",
        "ì†¡ì •ë™",
        "ì˜¥ìˆ˜ë™",
        "ìš©ë‹µë™",
        "ì‘ë´‰ë™",
        "í•˜ì™•ì‹­ë¦¬ë™",
        "í–‰ë‹¹ë™",
        "ì™•ì‹­ë¦¬ë„ì„ ë™",
    ],
    "ì„±ë¶êµ¬": [
        "ê¸¸ìŒë™",
        "ëˆì•”ë™",
        "ë™ì„ ë™",
        "ë³´ë¬¸ë™",
        "ì‚¼ì„ ë™",
        "ìƒì›”ê³¡ë™",
        "ì„ê´€ë™",
        "ì•ˆì•”ë™",
        "ì¥ìœ„ë™",
        "ì •ë¦‰ë™",
        "ì¢…ì•”ë™",
        "í•˜ì›”ê³¡ë™",
        "ì„±ë¶ë™",
        "ë™ì†Œë¬¸ë™1ê°€",
        "ë™ì†Œë¬¸ë™2ê°€",
        "ë™ì†Œë¬¸ë™3ê°€",
        "ë™ì†Œë¬¸ë™4ê°€",
        "ë™ì†Œë¬¸ë™5ê°€",
        "ì‚¼ì„ ë™1ê°€",
        "ì‚¼ì„ ë™2ê°€",
        "ì‚¼ì„ ë™3ê°€",
        "ì‚¼ì„ ë™4ê°€",
        "ì‚¼ì„ ë™5ê°€",
        "ë³´ë¬¸ë™1ê°€",
        "ë³´ë¬¸ë™2ê°€",
        "ë³´ë¬¸ë™3ê°€",
        "ë³´ë¬¸ë™4ê°€",
        "ë³´ë¬¸ë™5ê°€",
        "ë³´ë¬¸ë™6ê°€",
        "ë³´ë¬¸ë™7ê°€",
    ],
    "ì†¡íŒŒêµ¬": [
        "ê°€ë½ë™",
        "ê±°ì—¬ë™",
        "ë§ˆì²œë™",
        "ë¬¸ì •ë™",
        "ë°©ì´ë™",
        "ì‚¼ì „ë™",
        "ì„ì´Œë™",
        "ì†¡íŒŒë™",
        "ì‹ ì²œë™",
        "ì˜¤ê¸ˆë™",
        "ì˜¤ë¥œë™",
        "ìœ„ë¡€ë™",
        "ì¥ì§€ë™",
        "ì ì‹¤ë™",
        "í’ë‚©ë™",
    ],
    "ì–‘ì²œêµ¬": ["ëª©ë™", "ì‹ ì›”ë™", "ì‹ ì •ë™"],
    "ì˜ë“±í¬êµ¬": [
        "ë‹¹ì‚°ë™",
        "ëŒ€ë¦¼ë™",
        "ë„ë¦¼ë™",
        "ë¬¸ë˜ë™",
        "ì–‘í‰ë™",
        "ì—¬ì˜ë„ë™",
        "ì˜ë“±í¬ë™",
        "ì‹ ê¸¸ë™",
    ],
    "ìš©ì‚°êµ¬": [
        "ê°ˆì›”ë™",
        "ë‚¨ì˜ë™",
        "ë„ì›ë™",
        "ë™ìë™",
        "ë¬¸ë°°ë™",
        "ë³´ê´‘ë™",
        "ì„œê³„ë™",
        "ì„œë¹™ê³ ë™",
        "ìš©ë¬¸ë™",
        "ìš©ì‚°ë™2ê°€",
        "ìš©ì‚°ë™3ê°€",
        "ìš©ì‚°ë™4ê°€",
        "ìš©ì‚°ë™5ê°€",
        "ì›íš¨ë¡œ1ê°€",
        "ì›íš¨ë¡œ2ê°€",
        "ì´ì´Œë™",
        "ì´íƒœì›ë™",
        "ì²­ì•”ë™",
        "ì²­íŒŒë™1ê°€",
        "ì²­íŒŒë™2ê°€",
        "ì²­íŒŒë™3ê°€",
        "í•œê°•ë¡œ1ê°€",
        "í•œê°•ë¡œ2ê°€",
        "í•œë‚¨ë™",
        "í›„ì•”ë™",
        "ìš©ì‚°ë™1ê°€",
        "ìš©ì‚°ë™6ê°€",
        "í•œê°•ë¡œ3ê°€",
        "ë™ë¹™ê³ ë™",
        "ì£¼ì„±ë™",
        "ì‚°ì²œë™",
        "ì‹ ì°½ë™",
        "ì‹ ê³„ë™",
        "ì›íš¨ë¡œ3ê°€",
        "ì›íš¨ë¡œ4ê°€",
        "íš¨ì°½ë™",
    ],
    "ì€í‰êµ¬": [
        "ê°ˆí˜„ë™",
        "êµ¬ì‚°ë™",
        "ë…¹ë²ˆë™",
        "ëŒ€ì¡°ë™",
        "ë¶ˆê´‘ë™",
        "ìˆ˜ìƒ‰ë™",
        "ì‹ ì‚¬ë™",
        "ì—­ì´Œë™",
        "ì‘ì•”ë™",
        "ì¦ì‚°ë™",
        "ì§„ê´€ë™",
    ],
    "ì¢…ë¡œêµ¬": [
        "ê°€íšŒë™",
        "ê²¬ì§€ë™",
        "ê²½ìš´ë™",
        "ê³„ë™",
        "ê³µí‰ë™",
        "ê´€ìˆ˜ë™",
        "ê´€ì² ë™",
        "ê´€í›ˆë™",
        "êµë‚¨ë™",
        "êµë¶ë™",
        "êµ¬ê¸°ë™",
        "ê¶ì •ë™",
        "ê¶Œë†ë™",
        "ë‚™ì›ë™",
        "ë‚´ìˆ˜ë™",
        "ë‚´ìë™",
        "ëˆ„ìƒë™",
        "ëˆ„í•˜ë™",
        "ë‹¹ì£¼ë™",
        "ë„ë ´ë™",
        "ëˆì˜ë™",
        "ë™ìˆ­ë™",
        "ëª…ë¥œ1ê°€",
        "ëª…ë¥œ2ê°€",
        "ëª…ë¥œ3ê°€",
        "ëª…ë¥œ4ê°€",
        "ë¬˜ë™",
        "ë¬´ì•…ë™",
        "ë´‰ìµë™",
        "ë¶€ì•”ë™",
        "ì‚¬ê°„ë™",
        "ì‚¬ì§ë™",
        "ì‚¼ì²­ë™",
        "ì„œë¦°ë™",
        "ì„¸ì¢…ë¡œ",
        "ì†Œê²©ë™",
        "ì†¡í˜„ë™",
        "ìˆ­ì¸ë™",
        "ì‹ êµë™",
        "ì‹ ë¬¸ë¡œ1ê°€",
        "ì‹ ë¬¸ë¡œ2ê°€",
        "ì‹ ì˜ë™",
        "ì•ˆêµ­ë™",
        "ì—°ê±´ë™",
        "ì—°ì§€ë™",
        "ì˜ˆì§€ë™",
        "ì›ë‚¨ë™",
        "ìµì„ ë™",
        "ì¸ì‚¬ë™",
        "ì¸ì˜ë™",
        "ì¥ì‚¬ë™",
        "ì¬ë™",
        "ì ì„ ë™",
        "ì¢…ë¡œ1ê°€",
        "ì¢…ë¡œ2ê°€",
        "ì¢…ë¡œ3ê°€",
        "ì¢…ë¡œ4ê°€",
        "ì¢…ë¡œ5ê°€",
        "ì¢…ë¡œ6ê°€",
        "ì¤‘í•™ë™",
        "ì°½ì„±ë™",
        "ì°½ì‹ ë™",
        "ì²­ìš´ë™",
        "ì²­ì§„ë™",
        "ì¶©ì‹ ë™",
        "í†µì˜ë™",
        "í†µì¸ë™",
        "íŒ”íŒë™",
        "í‰ë™",
        "í‰ì°½ë™",
        "í•„ìš´ë™",
        "í™ì§€ë™",
        "í™”ë™",
        "íš¨ìë™",
        "íš¨ì œë™",
        "ì²´ë¶€ë™",
        "ë‚´ìë™",
        "ë„ë ´ë™",
        "ë‹¹ì£¼ë™",
        "ë‚´ìˆ˜ë™",
        "ì‹ ë¬¸ë¡œ1ê°€",
        "ì‹ ë¬¸ë¡œ2ê°€",
        "ì›ì„œë™",
        "ìˆ˜ì†¡ë™",
        "ìš´ë‹ˆë™",
        "ì™€ë£¡ë™",
        "í›ˆì •ë™",
    ],
    "ì¤‘êµ¬": [
        "ê´‘í¬ë™1ê°€",
        "ê´‘í¬ë™2ê°€",
        "ë‚¨ëŒ€ë¬¸ë¡œ1ê°€",
        "ë‚¨ëŒ€ë¬¸ë¡œ2ê°€",
        "ë‚¨ëŒ€ë¬¸ë¡œ3ê°€",
        "ë‚¨ëŒ€ë¬¸ë¡œ4ê°€",
        "ë‚¨ëŒ€ë¬¸ë¡œ5ê°€",
        "ë‚¨ì‚°ë™1ê°€",
        "ë‚¨ì‚°ë™2ê°€",
        "ë‚¨ì‚°ë™3ê°€",
        "ë‚¨ì°½ë™",
        "ë‚¨í•™ë™",
        "ë‹¤ë™",
        "ë§Œë¦¬ë™1ê°€",
        "ë§Œë¦¬ë™2ê°€",
        "ëª…ë™1ê°€",
        "ëª…ë™2ê°€",
        "ë¬´êµë™",
        "ë¬´í•™ë™",
        "ë°©ì‚°ë™",
        "ë´‰ë˜ë™1ê°€",
        "ë´‰ë˜ë™2ê°€",
        "ë¶ì°½ë™",
        "ì‚°ë¦¼ë™",
        "ì‚¼ê°ë™",
        "ì„œì†Œë¬¸ë™",
        "ì†Œê³µë™",
        "ìˆ˜í‘œë™",
        "ìˆ˜í•˜ë™",
        "ìˆœí™”ë™",
        "ì‹ ë‹¹ë™",
        "ìŒë¦¼ë™",
        "ì˜ˆê´€ë™",
        "ì˜¤ì¥ë™",
        "ì„ì§€ë¡œ1ê°€",
        "ì„ì§€ë¡œ2ê°€",
        "ì„ì§€ë¡œ3ê°€",
        "ì„ì§€ë¡œ4ê°€",
        "ì„ì§€ë¡œ5ê°€",
        "ì„ì§€ë¡œ6ê°€",
        "ì„ì§€ë¡œ7ê°€",
        "ì˜ì£¼ë¡œ1ê°€",
        "ì˜ì£¼ë¡œ2ê°€",
        "ì¸í˜„ë™1ê°€",
        "ì¸í˜„ë™2ê°€",
        "ì…ì •ë™",
        "ì¥êµë™",
        "ì €ë™1ê°€",
        "ì €ë™2ê°€",
        "ì •ë™",
        "ì£¼êµë™",
        "ì£¼ìë™",
        "ì¤‘ë¦¼ë™",
        "ì´ˆë™",
        "ì¶©ë¬´ë¡œ1ê°€",
        "ì¶©ë¬´ë¡œ2ê°€",
        "ì¶©ë¬´ë¡œ3ê°€",
        "ì¶©ë¬´ë¡œ4ê°€",
        "ì¶©ë¬´ë¡œ5ê°€",
        "íƒœí‰ë¡œ1ê°€",
        "íƒœí‰ë¡œ2ê°€",
        "í•„ë™1ê°€",
        "í•„ë™2ê°€",
        "í•„ë™3ê°€",
        "í™©í•™ë™",
        "íšŒí˜„ë™1ê°€",
        "íšŒí˜„ë™2ê°€",
        "íšŒí˜„ë™3ê°€",
        "íƒœí‰ë¡œ1ê°€",
        "ë¬´í•™ë™",
        "í¥ì¸ë™",
        "ì¸í˜„ë™",
        "ì €ë™2ê°€",
        "ì…ì •ë™",
    ],
    "ì¤‘ë‘êµ¬": ["ë©´ëª©ë™", "ë¬µë™", "ë§ìš°ë™", "ìƒë´‰ë™", "ì¤‘í™”ë™", "ì‹ ë‚´ë™"],
    "ì¤‘êµ¬": ["ì‹ í¬ë™", "ì°¨ì´ë‚˜íƒ€ìš´ë™", "í•­ë™", "ì˜ì¢…ë™", "ìš´ì„œë™", "ì„ì™•ë™"],
    "ë™êµ¬": ["í™”ìˆ˜ë™", "ì†¡ë¦¼ë™", "ì†¡í˜„ë™"],
    "ë¯¸ì¶”í™€êµ¬": ["ê´€êµë™", "ì£¼ì•ˆë™", "í•™ìµë™", "ë„í™”ë™", "ìˆ­ì˜ë™"],
    "ì—°ìˆ˜êµ¬": ["ë™ì¶˜ë™", "ì—°ìˆ˜ë™", "ì˜¥ë ¨ë™", "ì²­í•™ë™", "ì†¡ë„ë™"],
    "ë‚¨ë™êµ¬": ["êµ¬ì›”ë™", "ê°„ì„ë™", "ë§Œìˆ˜ë™", "ì¥ìˆ˜ë™", "ì„œì°½ë™", "ë…¼í˜„ë™"],
    "ë¶€í‰êµ¬": [
        "ë¶€í‰ë™",
        "ì‹­ì •ë™",
        "ì‚°ê³¡ë™",
        "ì²­ì²œë™",
        "ê°ˆì‚°ë™",
        "ì‚¼ì‚°ë™",
        "ë¶€ê°œë™",
        "ì¼ì‹ ë™",
    ],
    "ê³„ì–‘êµ¬": ["ê³„ì‚°ë™", "ì‘ì „ë™", "íš¨ì„±ë™"],
    "ì„œêµ¬": ["ê°€ì •ë™", "ì„ë‚¨ë™", "ê°€ì¢Œë™", "ê²€ë‹¨ë™", "ì²­ë¼ë™"],
    "ê°•í™”êµ°": ["ê°•í™”ì", "ì„ ì›ë©´", "ê¸¸ìƒë©´", "í•˜ì ë©´", "ë¶ˆì€ë©´"],
    "ì˜¹ì§„êµ°": ["ì˜í¥ë©´", "ë•ì ë©´", "ëŒ€ì²­ë©´", "ìì›”ë©´", "ì—°í‰ë©´"],
    "ìˆ˜ì›ì‹œ": {
        "ì¥ì•ˆêµ¬": [
            "íŒŒì¥ë™",
            "ìœ¨ì „ë™",
            "ì •ìë™",
            "ì˜í™”ë™",
            "ì†¡ì£½ë™",
            "ì¡°ì›ë™",
            "ì—°ë¬´ë™",
        ],
        "ê¶Œì„ êµ¬": [
            "ì„¸ë¥˜ë™",
            "ê¶Œì„ ë™",
            "ê³¡ì„ ë™",
            "êµ¬ìš´ë™",
            "ì…ë¶ë™",
            "ì„œë‘”ë™",
            "ê³ ìƒ‰ë™",
            "íƒ‘ë™",
            "í‰ë™",
            "ëŒ€í™©êµë™",
        ],
        "íŒ”ë‹¬êµ¬": [
            "ì¸ê³„ë™",
            "ë§¤êµë™",
            "ë§¤ì‚°ë¡œë™",
            "êµë™",
            "ì‹ í’ë™",
            "ë‚¨ìˆ˜ë™",
            "ë‚¨ì°½ë™",
            "ì§€ë™",
            "ìš°ë§Œë™",
            "í™”ì„œë™",
        ],
        "ì˜í†µêµ¬": ["ì˜í†µë™", "ë§í¬ë™", "ì›ì²œë™", "ì´ì˜ë™", "í•˜ë™", "ì‹ ë™", "ê´‘êµë™"],
    },
    "ì„±ë‚¨ì‹œ": {
        "ìˆ˜ì •êµ¬": [
            "ìˆ˜ì§„ë™",
            "ì‹ í¥ë™",
            "íƒœí‰ë™",
            "ìƒëŒ€ì›ë™",
            "ë‹¨ëŒ€ë™",
            "ì‚°ì„±ë™",
            "ì–‘ì§€ë™",
            "ë³µì •ë™",
            "ì°½ê³¡ë™",
        ],
        "ì¤‘ì›êµ¬": [
            "ì„±ë‚¨ë™",
            "ì¤‘ì•™ë™",
            "ê¸ˆê´‘ë™",
            "ì€í–‰ë™",
            "ìƒëŒ€ì›ë™",
            "í•˜ëŒ€ì›ë™",
            "ë„ì´Œë™",
        ],
        "ë¶„ë‹¹êµ¬": [
            "ì´ë§¤ë™",
            "ì•¼íƒ‘ë™",
            "ì •ìë™",
            "ì„œí˜„ë™",
            "ìˆ˜ë‚´ë™",
            "íŒêµë™",
            "ì‚¼í‰ë™",
            "ìš´ì¤‘ë™",
            "êµ¬ë¯¸ë™",
            "ê¸ˆê³¡ë™",
            "ë™ì›ë™",
        ],
    },
    "ì˜ì •ë¶€ì‹œ": [
        "ì˜ì •ë¶€ë™",
        "í˜¸ì›ë™",
        "ì¥ì•”ë™",
        "ì‹ ê³¡ë™",
        "ë¯¼ë½ë™",
        "ê°€ëŠ¥ë™",
        "í¥ì„ ë™",
        "ë…¹ì–‘ë™",
    ],
    "ì•ˆì–‘ì‹œ": {
        "ë§Œì•ˆêµ¬": ["ì•ˆì–‘ë™", "ì„ìˆ˜ë™", "ë°•ë‹¬ë™"],
        "ë™ì•ˆêµ¬": [
            "ë¹„ì‚°ë™",
            "ê´€ì–‘ë™",
            "ë¶€í¥ë™",
            "í‰ì´Œë™",
            "í˜¸ê³„ë™",
            "ë²”ê³„ë™",
            "ë‹¬ì•ˆë™",
            "ê·€ì¸ë™",
        ],
    },
    "ë¶€ì²œì‹œ": {
        "ì†Œì‚¬êµ¬": ["ì†Œì‚¬ë³¸ë™", "ì†¡ë‚´ë™", "ì‹¬ê³¡ë³¸ë™"],
        "ì˜¤ì •êµ¬": ["ì›ì¢…ë™", "ì˜¤ì •ë™", "ì‘ë™", "ê³ ê°•ë™", "ì‚¼ì •ë™"],
        "ì›ë¯¸êµ¬": [
            "ì¤‘ë™",
            "ìƒë™",
            "ì—¬ì›”ë™",
            "ë„ë‹¹ë™",
            "ì¶˜ì˜ë™",
            "ì‹¬ê³¡ë™",
            "ì†Œì‚¬ë™",
            "ì—­ê³¡ë™",
        ],
    },
    "ê´‘ëª…ì‹œ": [
        "ê´‘ëª…ë™",
        "ì² ì‚°ë™",
        "í•˜ì•ˆë™",
        "ì†Œí•˜ë™",
        "ì¼ì§ë™",
        "ë…¸ì˜¨ì‚¬ë™",
        "ê°€í•™ë™",
        "ì˜¥ê¸¸ë™",
    ],
    "í‰íƒì‹œ": [
        "í‰íƒë™",
        "ë¹„ì „ë™",
        "í†µë³µë™",
        "í•©ì •ë™",
        "ì„œì •ë™",
        "ì¥ë‹¹ë™",
        "ë™ì‚­ë™",
        "ìš©ì´ë™",
        "ì•ˆì¤‘ì",
        "ì˜¤ì„±ë©´",
        "ì²­ë¶ì",
        "í¬ìŠ¹ì",
        "ê³ ë•ë©´",
        "ì§„ìœ„ë©´",
        "í˜„ë•ë©´",
        "íŒ½ì„±ì",
    ],
    "ë™ë‘ì²œì‹œ": [
        "ìƒì—°ë™",
        "ì†¡ë‚´ë™",
        "ì§€í–‰ë™",
        "ë™ë‘ì²œë™",
        "ìƒíŒ¨ë™",
        "ì•ˆí¥ë™",
        "íƒ‘ë™ë™",
        "ë³´ì‚°ë™",
    ],
    "ì•ˆì‚°ì‹œ": {
        "ìƒë¡êµ¬": [
            "ì¼ë™",
            "ì´ë™",
            "ë³¸ì˜¤ë™",
            "ì‚¬ë™",
            "ë¶€ê³¡ë™",
            "ì›”í”¼ë™",
            "ì„±í¬ë™",
            "ë°˜ì›”ë™",
            "ìˆ˜ì•”ë™",
        ],
        "ë‹¨ì›êµ¬": ["ì™€ë™", "ê³ ì”ë™", "ì›ê³¡ë™", "ì´ˆì§€ë™", "ì„ ë¶€ë™", "ì‹ ê¸¸ë™", "ëŒ€ë¶€ë™"],
    },
    "ê³ ì–‘ì‹œ": {
        "ë•ì–‘êµ¬": [
            "ì£¼êµë™",
            "ì›ì‹ ë™",
            "ì„±ì‚¬ë™",
            "í™”ì •ë™",
            "í–‰ì‹ ë™",
            "ëŠ¥ê³¡ë™",
            "ì‹ ë„ë™",
            "ì‚¼ì†¡ë™",
            "ì§€ì¶•ë™",
            "ê³ ì–‘ë™",
            "ê´€ì‚°ë™",
            "ë™ì‚°ë™",
        ],
        "ì¼ì‚°ë™êµ¬": [
            "ì •ë°œì‚°ë™",
            "ì¥í•­ë™",
            "ë°±ì„ë™",
            "ë§ˆë‘ë™",
            "ì‹ì‚¬ë™",
            "í’ë™",
            "ì¤‘ì‚°ë™",
            "ë¬¸ë´‰ë™",
            "ì„¤ë¬¸ë™",
        ],
        "ì¼ì‚°ì„œêµ¬": [
            "ëŒ€í™”ë™",
            "ì†¡í¬ë™",
            "ì£¼ì—½ë™",
            "íƒ„í˜„ë™",
            "ë•ì´ë™",
            "ê°€ì¢Œë™",
            "ì¼ì‚°ë™",
        ],
    },
    "ê³¼ì²œì‹œ": ["ë³„ì–‘ë™", "ë¶€ë¦¼ë™", "ê³¼ì²œë™", "ì£¼ì•”ë™", "ë¬¸ì›ë™"],
    "êµ¬ë¦¬ì‹œ": ["êµë¬¸ë™", "ìˆ˜íƒë™", "ì¸ì°½ë™", "í† í‰ë™"],
    "ë‚¨ì–‘ì£¼ì‹œ": [
        "ê¸ˆê³¡ë™",
        "ìˆ˜ì„ë™",
        "í˜¸í‰ë™",
        "í‰ë‚´ë™",
        "ì˜¤ë‚¨ì",
        "í™”ë„ì",
        "ì§„ì ‘ì",
        "ì™€ë¶€ì",
        "ë³„ë‚´ë™",
        "í‡´ê³„ì›ì",
        "ì¡°ì•ˆë©´",
        "ì§„ê±´ì",
        "ì–‘ì •ë™",
        "ë‹¤ì‚°ë™",
    ],
    "ì˜¤ì‚°ì‹œ": [
        "ì˜¤ì‚°ë™",
        "ì›ë™",
        "ë²ŒìŒë™",
        "ì™¸ì‚¼ë¯¸ë™",
        "ë‚´ì‚¼ë¯¸ë™",
        "ì„¸êµë™",
        "ê°€ì¥ë™",
        "ê¸ˆì•”ë™",
        "ìˆ˜ì²­ë™",
        "ì²­í•™ë™",
        "ì–‘ì‚°ë™",
    ],
    "ì‹œí¥ì‹œ": [
        "ì •ì™•ë™",
        "ì‹ ì²œë™",
        "ëŒ€ì•¼ë™",
        "ë§¤í™”ë™",
        "ì€í–‰ë™",
        "ê³¼ë¦¼ë™",
        "ëª©ê°ë™",
        "ì¥ê³¡ë™",
        "ë…¼ê³¡ë™",
        "ê¸ˆì´ë™",
        "ë¯¸ì‚°ë™",
        "ë°©ì‚°ë™",
        "ë°°ê³§ë™",
    ],
    "êµ°í¬ì‹œ": ["ë‹¹ì •ë™", "ì‚°ë³¸ë™", "ê¸ˆì •ë™", "ê¶ë‚´ë™", "ë¶€ê³¡ë™", "ì†ë‹¬ë™", "ëŒ€ì•¼ë¯¸ë™"],
    "ì˜ì™•ì‹œ": ["ê³ ì²œë™", "ì˜¤ì „ë™", "ì™•ê³¡ë™", "ì‚¼ë™", "ì²­ê³„ë™", "ë‚´ì†ë™", "í¬ì¼ë™"],
    "í•˜ë‚¨ì‹œ": [
        "ì²œí˜„ë™",
        "ì‹ ì¥ë™",
        "ë•í’ë™",
        "ì°½ìš°ë™",
        "ê°ë¶ë™",
        "ê°ì¼ë™",
        "ìœ„ë¡€ë™",
        "í’ì‚°ë™",
        "ì¶˜ê¶ë™",
        "í•˜ì‚°ê³¡ë™",
    ],
    "ìš©ì¸ì‹œ": {
        "ì²˜ì¸êµ¬": [
            "ê¹€ëŸ‰ì¥ë™",
            "ë‚¨ë™",
            "ì—­ë¶ë™",
            "ì‚¼ê°€ë™",
            "ë™ë¶€ë™",
            "ìœ ë°©ë™",
            "ìš´í•™ë™",
            "ê³ ë¦¼ë™",
            "ë§ˆí‰ë™",
            "í˜¸ë™",
            "í¬ê³¡ì",
            "ëª¨í˜„ì",
            "ì´ë™ì",
            "ë°±ì•”ë©´",
            "ì›ì‚¼ë©´",
            "ì–‘ì§€ë©´",
        ],
        "ê¸°í¥êµ¬": [
            "ê¸°í¥ë™",
            "êµ¬ê°ˆë™",
            "êµ¬ì„±ë™",
            "ë™ë°±ë™",
            "ë§ˆë¶ë™",
            "ìƒê°ˆë™",
            "ìƒí•˜ë™",
            "ë³´ë¼ë™",
            "ì‹ ê°ˆë™",
            "ì˜ë•ë™",
            "ì¤‘ë™",
            "ì„œë†ë™",
        ],
        "ìˆ˜ì§€êµ¬": ["ì£½ì „ë™", "í’ë•ì²œë™", "ì‹ ë´‰ë™", "ì„±ë³µë™", "ë™ì²œë™"],
    },
    "íŒŒì£¼ì‹œ": [
        "ê¸ˆì´Œë™",
        "ì•„ë™ë™",
        "ì•¼ë™ë™",
        "ê²€ì‚°ë™",
        "ë§¥ê¸ˆë™",
        "êµí•˜ë™",
        "ì¡°ë¦¬ì",
        "ë¬¸ì‚°ì",
        "ë²•ì›ì",
        "ê´‘íƒ„ë©´",
        "íŒŒí‰ë©´",
        "ì ì„±ë©´",
        "íƒ„í˜„ë©´",
        "íŒŒì£¼ì",
        "ì¥ë‹¨ë©´",
        "ì›”ë¡±ë©´",
        "êµ°ë‚´ë©´",
        "ì¥íŒŒë©´",
    ],
    "ì´ì²œì‹œ": [
        "ê´€ê³ ë™",
        "ì¤‘ë¦¬ë™",
        "ì¦í¬ë™",
        "ì°½ì „ë™",
        "ì‹ ë‘”ë©´",
        "ë°±ì‚¬ë©´",
        "ë§ˆì¥ë©´",
        "ë¶€ë°œì",
        "ëŒ€ì›”ë©´",
        "í˜¸ë²•ë©´",
        "ëª¨ê°€ë©´",
        "ì„¤ì„±ë©´",
        "ìœ¨ë©´",
    ],
    "ì•ˆì„±ì‹œ": [
        "ë´‰ì‚°ë™",
        "ì˜¥ì‚°ë™",
        "ì¸ì§€ë™",
        "ê³„ë™",
        "ì‚¬ê³¡ë™",
        "ê¸ˆì„ë™",
        "ë‹¹ì™•ë™",
        "êµ¬í¬ë™",
        "ì•ˆì„±ë™",
        "ì„ì •ë™",
        "ì‹ ê±´ì§€ë™",
        "ëŒ€ì²œë™",
        "ì˜¥ì²œë™",
        "í˜„ìˆ˜ë™",
        "ë°œí™”ë™",
        "ì•„ì–‘ë™",
        "ì—°ì§€ë™",
        "í˜„ë§¤ë™",
        "ì–‘ì„±ë©´",
        "ì›ê³¡ë©´",
        "ë³´ê°œë©´",
        "ì¼ì£½ë©´",
        "ì£½ì‚°ë©´",
        "ì‚¼ì£½ë©´",
        "ê³ ì‚¼ë©´",
        "ê¸ˆê´‘ë©´",
        "ì„œìš´ë©´",
        "ë¯¸ì–‘ë©´",
        "ëŒ€ë•ë©´",
    ],
    "ê¹€í¬ì‹œ": [
        "ë¶ë³€ë™",
        "ê±¸í¬ë™",
        "ê°ì •ë™",
        "ì¥ê¸°ë™",
        "ì‚¬ìš°ë™",
        "í’ë¬´ë™",
        "í†µì§„ì",
        "ê³ ì´Œì",
        "ì–‘ì´Œì",
        "ëŒ€ê³¶ë©´",
        "ì›”ê³¶ë©´",
        "í•˜ì„±ë©´",
    ],
    "í™”ì„±ì‹œ": [
        "ì§„ì•ˆë™",
        "ë³‘ì ë™",
        "ë°˜ì›”ë™",
        "ê¸°ì‚°ë™",
        "ì§„ì•ˆë™",
        "ì•ˆë…•ë™",
        "ë°˜ì†¡ë™",
        "ì„ìš°ë™",
        "ë§ˆë„ë©´",
        "ì†¡ì‚°ë©´",
        "ì„œì‹ ë©´",
        "íŒ”íƒ„ë©´",
        "í–¥ë‚¨ì",
        "ì •ë‚¨ë©´",
        "ìš°ì •ì",
        "ë‚¨ì–‘ì",
        "ë¹„ë´‰ë©´",
        "ì¥ì•ˆë©´",
        "ì–‘ê°ë©´",
        "ì¥ì§€ë™",
        "ì˜ì²œë™",
        "ì†¡ë™",
        "ë™íƒ„ë©´",
        "ë™íƒ„ë™",
    ],
    "ê´‘ì£¼ì‹œ": [
        "ê²½ì•ˆë™",
        "ì†¡ì •ë™",
        "ìŒë ¹ë™",
        "ëª©ë™",
        "ì‚¼ë™",
        "íƒ„ë²Œë™",
        "ì¥ì§€ë™",
        "ì¤‘ëŒ€ë™",
        "íšŒë•ë™",
        "ì§ë™",
        "ì–‘ë²Œë™",
        "ì¥ì§€ë™",
        "ë„ì²™ë©´",
        "ë‚¨ì¢…ë©´",
        "ë‚¨í•œì‚°ì„±ë©´",
        "ë‚¨ì¢…ë©´",
        "ì´ˆì›”ì",
        "ê³¤ì§€ì•”ì",
        "í‡´ì´Œë©´",
        "ì˜¤í¬ì",
    ],
    "ì–‘ì£¼ì‹œ": [
        "ë‚¨ë°©ë™",
        "ë‚¨ë©´",
        "ë‚¨ì™¸ë™",
        "ëŠ¥ì•”ë™",
        "ë•ê³„ë™",
        "ë§Œì†¡ë™",
        "ë°±ì„ì",
        "ì‚¼ìˆ­ë™",
        "ìœ ì–‘ë™",
        "ì€í˜„ë©´",
        "ì¥í¥ë©´",
        "ê³ ì•”ë™",
        "ê´‘ì‚¬ë™",
        "íšŒì•”ë™",
        "ê³ ìë™",
        "ë•ì •ë™",
    ],
    "í¬ì²œì‹œ": [
        "ê´€ì¸ë©´",
        "êµ°ë‚´ë©´",
        "ë‚´ì´Œë©´",
        "ë™êµë™",
        "ì„ ë‹¨ë™",
        "ì„¤ìš´ë™",
        "ì‹ ìë™",
        "ìì‘ë™",
        "ì‹ ë¶ë©´",
        "ì˜ë¶ë©´",
        "ì˜ì¤‘ë©´",
        "ì¼ë™ë©´",
        "ì´ë™ë©´",
        "ì°½ìˆ˜ë©´",
        "í™”í˜„ë©´",
        "ì†Œí˜ì",
        "í¬ì²œë™",
    ],
    "ì—¬ì£¼ì‹œ": [
        "ê°€ë‚¨ì",
        "ê°•ì²œë©´",
        "ê¸ˆì‚¬ë©´",
        "ëŠ¥ì„œë©´",
        "ëŒ€ì‹ ë©´",
        "ì‚°ë¶ë©´",
        "ì ë™ë©´",
        "ì˜¤í•™ë™",
        "ì—¬í¥ë™",
        "í™ë¬¸ë™",
        "í¥ì²œë©´",
    ],
    "ì—°ì²œêµ°": [
        "ì „ê³¡ì",
        "ì—°ì²œì",
        "êµ°ë‚¨ë©´",
        "ë°±í•™ë©´",
        "ë¯¸ì‚°ë©´",
        "ì™•ì§•ë©´",
        "ì¥ë‚¨ë©´",
        "ì²­ì‚°ë©´",
        "ì‹ ì„œë©´",
        "ì¤‘ë©´",
        "ë°±ì˜ë©´",
    ],
    "ê°€í‰êµ°": ["ê°€í‰ì", "ì„¤ì•…ë©´", "ì²­í‰ë©´", "ìƒë©´", "ì¡°ì¢…ë©´", "ë¶ë©´"],
    "ì–‘í‰êµ°": [
        "ì–‘í‰ì",
        "ê°•ìƒë©´",
        "ê°•í•˜ë©´",
        "ê°œêµ°ë©´",
        "ë‹¨ì›”ë©´",
        "ì„œì¢…ë©´",
        "ì–‘ë™ë©´",
        "ì˜¥ì²œë©´",
        "ìš©ë¬¸ë©´",
        "ì§€í‰ë©´",
        "ì²­ìš´ë©´",
    ],
}

# ê³ ì • ì¢Œí‘œ (ëŒ€í•œë¯¼êµ­ ì „ì²´)
COORDINATES = {
  "north_east_lng": "131.900000",
  "north_east_lat": "43.000000",
  "south_west_lng": "124.610058", 
  "south_west_lat": "32.000000",
}

# User Agent í’€ (ì°¨ë‹¨ ë°©ì§€)
USER_AGENTS = [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15",
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Edge/120.0.0.0 Safari/537.36",
    "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
]

class MetropolitanCrawler:
    def __init__(self):
        self.http_client = httpx.Client(timeout=30.0)
        self.all_fields_discovered = set()
        self.failed_areas = []
        self.total_processed = 0

    def get_random_headers(self) -> Dict[str, str]:
        """ëœë¤ í—¤ë” ìƒì„± (ì°¨ë‹¨ ë°©ì§€)"""
        return {
            "User-Agent": random.choice(USER_AGENTS),
            "Accept": "application/json, text/javascript, */*; q=0.01",
            "Accept-Language": random.choice(
                ["ko-KR,ko;q=0.9,en;q=0.8", "ko,en-US;q=0.9,en;q=0.8"]
            ),
            "Accept-Encoding": "gzip, deflate, br",
            "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            "Origin": "https://33m2.co.kr",
            "Referer": "https://33m2.co.kr/webpc/search/map",
            "Cache-Control": "no-cache",
        }

    def adaptive_delay(self, region_type: str = "normal"):
        """ì§€ì—­ íƒ€ì…ì— ë”°ë¥¸ ì ì‘í˜• ë”œë ˆì´"""
        if region_type == "seoul":
            delay = random.uniform(REQUEST_DELAY_MIN + 0.5, REQUEST_DELAY_MAX + 1.0)
        elif region_type == "incheon":
            delay = random.uniform(REQUEST_DELAY_MIN, REQUEST_DELAY_MAX + 0.5)
        else:  # gyeonggi
            delay = random.uniform(REQUEST_DELAY_MIN, REQUEST_DELAY_MAX)

        print(f"    ğŸ’¤ {delay:.1f}ì´ˆ ëŒ€ê¸° ì¤‘...", end="", flush=True)
        time.sleep(delay)
        print(" âœ“")

    def discover_fields(self, rooms: List[Dict]) -> Set[str]:
        """ì‘ë‹µ ë°ì´í„°ì—ì„œ ëª¨ë“  í•„ë“œ ë°œê²¬"""
        discovered_fields = set()

        for room in rooms:
            if isinstance(room, dict):
                for key in room.keys():
                    discovered_fields.add(key)

                try:
                    flattened = pd.json_normalize([room])
                    for col in flattened.columns:
                        discovered_fields.add(col)
                except:
                    pass

        return discovered_fields

    def flatten_room_data(self, room: Dict) -> Dict:
        """ë°© ë°ì´í„°ë¥¼ í‰ë©´í™” (ëª¨ë“  ì¤‘ì²© í•„ë“œ í¬í•¨)"""
        try:
            flattened_df = pd.json_normalize([room])

            if len(flattened_df) > 0:
                flattened_dict = flattened_df.iloc[0].to_dict()

                # í¬ë¡¤ë§ ë©”íƒ€ë°ì´í„° ì¶”ê°€
                flattened_dict["crawl_datetime"] = datetime.now().strftime(
                    "%Y-%m-%d %H:%M:%S"
                )
                flattened_dict["crawl_timestamp"] = int(datetime.now().timestamp())

                return flattened_dict
            else:
                return room
        except Exception as e:
            print(f"    âš ï¸ ë°ì´í„° í‰ë©´í™” ì‹¤íŒ¨: {e}")
            return room

    def fetch_area_rooms(self, keyword: str, region_type: str = "normal") -> List[Dict]:
        """ì§€ì—­ë³„ ì˜¤í”¼ìŠ¤í…”&ì•„íŒŒíŠ¸ ë§¤ë¬¼ ìˆ˜ì§‘"""
        self.http_client.headers.update(self.get_random_headers())

        payload = {
            "keyword": keyword,
            "by_location": "true",
            "north_east_lng": COORDINATES["north_east_lng"],
            "north_east_lat": COORDINATES["north_east_lat"],
            "south_west_lng": COORDINATES["south_west_lng"],
            "south_west_lat": COORDINATES["south_west_lat"],
            "itemcount": "1000",
        }

        max_retries = 3
        for attempt in range(max_retries):
            try:
                response = self.http_client.post(SEARCH_URL, data=payload)

                if response.status_code == 403:
                    print(
                        f"    ğŸš« 403 ì°¨ë‹¨ - í—¤ë” ë³€ê²½ í›„ ì¬ì‹œë„ ({attempt + 1}/{max_retries})"
                    )
                    time.sleep(random.uniform(5.0, 10.0))
                    self.http_client.headers.update(self.get_random_headers())
                    continue

                response.raise_for_status()
                result = response.json()

                if result.get("error_code", 0) == 0 and "list" in result:
                    rooms = result["list"]
                    print(f"    âœ… {keyword}: {len(rooms)}ê°œ ë§¤ë¬¼ ìˆ˜ì§‘")

                    # í•„ë“œ ë°œê²¬ ë° ì¶”ì 
                    discovered_fields = self.discover_fields(rooms)
                    new_fields = discovered_fields - self.all_fields_discovered
                    self.all_fields_discovered.update(discovered_fields)

                    if new_fields:
                        print(f"    ğŸ†• ìƒˆ í•„ë“œ ë°œê²¬: {', '.join(list(new_fields)[:3])}")

                    if len(rooms) >= 1000:
                        print(f"    âš ï¸  {keyword}: 1000ê°œ ë„ë‹¬ - ì„¸ë¶„í™” ê¶Œì¥")

                    return rooms
                else:
                    print(
                        f"    âŒ {keyword}: API ì˜¤ë¥˜ (error_code: {result.get('error_code')})"
                    )
                    return []

            except Exception as e:
                print(
                    f"    âŒ {keyword}: ìš”ì²­ ì‹¤íŒ¨ (ì‹œë„ {attempt + 1}/{max_retries}) - {str(e)[:50]}"
                )
                if attempt < max_retries - 1:
                    time.sleep(random.uniform(3.0, 6.0))
                continue

        # ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨
        self.failed_areas.append(keyword)
        return []

    def process_area_with_subdivision(self, area: str, region_name: str) -> List[Dict]:
        """ì§€ì—­ë³„ ì²˜ë¦¬ (í•„ìš”ì‹œ ì„¸ë¶„í™”)"""
        region_type = (
            "seoul"
            if region_name == "ì„œìš¸íŠ¹ë³„ì‹œ"
            else ("incheon" if region_name == "ì¸ì²œê´‘ì—­ì‹œ" else "gyeonggi")
        )
        print(f"\nğŸ¢ {region_name} {area} ì²˜ë¦¬ ì¤‘...")

        # ë¨¼ì € ì§€ì—­ ë‹¨ìœ„ë¡œ ì‹œë„
        area_rooms = self.fetch_area_rooms(area, region_type)

        # 1000ê°œ ë¯¸ë§Œì´ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
        if len(area_rooms) < 1000:
            processed_rooms = []
            for room in area_rooms:
                flattened_room = self.flatten_room_data(room)
                flattened_room["search_keyword"] = area
                flattened_room["region_name"] = region_name
                processed_rooms.append(flattened_room)
            return processed_rooms

        # 1000ê°œ ì´ìƒì´ë©´ ì„¸ë¶„í™”
        print(f"  ğŸ”„ {area} ì„¸ë¶„í™” ì‹œì‘...")
        all_rooms = []

        if area in DISTRICT_SUBDIVISIONS:
            subdivisions = DISTRICT_SUBDIVISIONS[area]

            for subdivision in subdivisions:
                sub_keyword = f"{area} {subdivision}"
                sub_rooms = self.fetch_area_rooms(sub_keyword, region_type)

                for room in sub_rooms:
                    flattened_room = self.flatten_room_data(room)
                    flattened_room["search_keyword"] = sub_keyword
                    flattened_room["region_name"] = region_name
                    all_rooms.append(flattened_room)

                # ì„¸ë¶„í™” ê°„ ë”œë ˆì´
                self.adaptive_delay(region_type)
        else:
            print(f"    âš ï¸  {area} ì„¸ë¶„í™” ì •ë³´ ì—†ìŒ - ì›ë³¸ ë°ì´í„° ì‚¬ìš©")
            for room in area_rooms:
                flattened_room = self.flatten_room_data(room)
                flattened_room["search_keyword"] = area
                flattened_room["region_name"] = region_name
                all_rooms.append(flattened_room)

        # ì¤‘ë³µ ì œê±° (rid ê¸°ì¤€)
        unique_rooms = {}
        for room in all_rooms:
            rid = room.get("rid")
            if rid and rid not in unique_rooms:
                unique_rooms[rid] = room

        final_rooms = list(unique_rooms.values())
        print(f"  âœ… {area} ìµœì¢…: {len(final_rooms)}ê°œ (ì¤‘ë³µ ì œê±°)")
        return final_rooms

    def close(self):
        """ë¦¬ì†ŒìŠ¤ ì •ë¦¬"""
        try:
            if self.http_client:
                self.http_client.close()
        except:
            pass


def save_results_complete(all_rooms: List[Dict]):
    """ì™„ì „í•œ ê²°ê³¼ ì €ì¥"""
    try:
        if not all_rooms:
            print("âŒ ì €ì¥í•  ë°ì´í„° ì—†ìŒ")
            return

        df = pd.json_normalize(all_rooms)

        print(f"ğŸ“Š ë°œê²¬ëœ ì´ í•„ë“œ ìˆ˜: {len(df.columns)}ê°œ")
        print(f"ğŸ“‹ ì£¼ìš” í•„ë“œ: {list(df.columns)[:8]}...")

        # CSV ì €ì¥
        df.to_csv(OUTPUT_FILE, index=False, encoding="utf-8-sig")

        print(f"ğŸ’¾ ì €ì¥ ì™„ë£Œ: {OUTPUT_FILE}")
        print(f"ğŸ“Š ì´ ë§¤ë¬¼: {len(all_rooms):,}ê°œ")
        print(f"ğŸ“‹ ì´ ì»¬ëŸ¼: {len(df.columns)}ê°œ")

        # ì§€ì—­ë³„ í†µê³„
        if "region_name" in df.columns:
            region_stats = df["region_name"].value_counts()
            print(f"\nğŸ“ˆ ì§€ì—­ë³„ ë§¤ë¬¼ ìˆ˜:")
            for region, count in region_stats.items():
                print(f"  ğŸ“ {region}: {count:,}ê°œ")

        # ìƒ˜í”Œ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°
        if len(df) > 0:
            print(f"\nğŸ“‹ ìƒ˜í”Œ ë°ì´í„°:")
            sample_cols = [
                "rid",
                "room_name",
                "province",
                "town",
                "using_fee",
                "pyeong_size",
                "region_name",
            ]
            available_sample_cols = [col for col in sample_cols if col in df.columns]
            if available_sample_cols:
                print(df[available_sample_cols].head(3).to_string(index=False))

    except Exception as e:
        print(f"âŒ ì €ì¥ ì‹¤íŒ¨: {e}")
        import traceback

        traceback.print_exc()


def print_progress(
    current: int,
    total: int,
    area: str,
    room_count: int,
    elapsed_time: float,
    region: str,
):
    """ì§„í–‰ë¥  í‘œì‹œ"""
    percentage = (current / total) * 100
    bar_length = 30
    filled_length = int(bar_length * current // total)
    bar = "â–ˆ" * filled_length + "â–‘" * (bar_length - filled_length)

    if current > 0:
        avg_time = elapsed_time / current
        eta = (total - current) * avg_time
        eta_str = f"{int(eta//60):02d}:{int(eta%60):02d}"
    else:
        eta_str = "00:00"

    print(
        f"\rğŸ™ï¸ [{current:2d}/{total}] [{bar}] {percentage:5.1f}% | ETA: {eta_str} | {region[:2]} {area:<8} | {room_count:4d}ê°œ",
        end="",
        flush=True,
    )


def main():
    """ë©”ì¸ ì‹¤í–‰"""
    print("ğŸš€ 33m2 ìˆ˜ë„ê¶Œ ì „ì²´ ì˜¤í”¼ìŠ¤í…”&ì•„íŒŒíŠ¸ í¬ë¡¤ë§ - ì™„ì „íŒ")
    print(f"ğŸ¯ ëŒ€ìƒ: ìˆ˜ë„ê¶Œ 66ê°œ ê¸°ì´ˆìì¹˜ë‹¨ì²´ (ì„œìš¸25 + ì¸ì²œ10 + ê²½ê¸°31)")
    print(f"ğŸ¢ ë§¤ë¬¼ íƒ€ì…: ì˜¤í”¼ìŠ¤í…”, ì•„íŒŒíŠ¸")
    print(f"â±ï¸ ë”œë ˆì´: ì§€ì—­ë³„ ì ì‘í˜• ({REQUEST_DELAY_MIN}~{REQUEST_DELAY_MAX}ì´ˆ)")
    print(f"ğŸ›¡ï¸ ì°¨ë‹¨ ë°©ì§€: User-Agent ë¡œí…Œì´ì…˜ + ì‹¤íŒ¨ ë³µêµ¬")
    print(f"ğŸ“Š ë°ì´í„°: API ì‘ë‹µì˜ ëª¨ë“  í•„ë“œ ìë™ ì €ì¥ + ì§€ì—­ ë©”íƒ€ë°ì´í„°")
    print("=" * 80)

    crawler = MetropolitanCrawler()
    start_time = time.time()

    try:
        all_rooms = []
        total_areas = sum(len(areas) for areas in METROPOLITAN_AREAS.values())
        current_count = 0

        print(f"ğŸ“ ìˆ˜ì§‘ ì‹œì‘: {total_areas}ê°œ ê¸°ì´ˆìì¹˜ë‹¨ì²´")
        for region_name, areas in METROPOLITAN_AREAS.items():
            print(
                f"ğŸ“‹ {region_name}: {len(areas)}ê°œ - {', '.join(areas[:5])}{'...' if len(areas) > 5 else ''}"
            )
        print("=" * 80)

        for region_name, areas in METROPOLITAN_AREAS.items():
            print(f"\nğŸŒŸ {region_name} ì§€ì—­ ì‹œì‘ ({len(areas)}ê°œ ì§€ì—­)")

            for i, area in enumerate(areas, 1):
                current_count += 1

                try:
                    area_rooms = crawler.process_area_with_subdivision(
                        area, region_name
                    )
                    all_rooms.extend(area_rooms)

                    # ì§„í–‰ë¥  í‘œì‹œ
                    total_elapsed = time.time() - start_time
                    print_progress(
                        current_count,
                        total_areas,
                        area,
                        len(area_rooms),
                        total_elapsed,
                        region_name,
                    )

                    # ì¤‘ê°„ ì €ì¥ (10ê°œ ì§€ì—­ë§ˆë‹¤)
                    if current_count % 10 == 0:
                        print(f"\n    ğŸ’¾ ì¤‘ê°„ ì €ì¥: {len(all_rooms):,}ê°œ ë§¤ë¬¼")
                        save_results_complete(all_rooms)

                    # ì§€ì—­ ê°„ ë”œë ˆì´
                    if current_count < total_areas:
                        print()  # ìƒˆ ì¤„
                        region_type = (
                            "seoul"
                            if region_name == "ì„œìš¸íŠ¹ë³„ì‹œ"
                            else (
                                "incheon" if region_name == "ì¸ì²œê´‘ì—­ì‹œ" else "gyeonggi"
                            )
                        )
                        crawler.adaptive_delay(region_type)

                except KeyboardInterrupt:
                    print(f"\nâ¹ï¸ ì‚¬ìš©ì ì¤‘ë‹¨ - {current_count}ê°œ ì§€ì—­ ì™„ë£Œ")
                    break
                except Exception as e:
                    print(f"\nâŒ {region_name} {area} ì²˜ë¦¬ ì‹¤íŒ¨: {str(e)[:50]}")
                    continue

            if current_count != sum(
                len(areas)
                for areas in list(METROPOLITAN_AREAS.values())[
                    : list(METROPOLITAN_AREAS.keys()).index(region_name) + 1
                ]
            ):
                break  # ì‚¬ìš©ì ì¤‘ë‹¨ ì‹œ ì „ì²´ ì¤‘ë‹¨

        # ìµœì¢… ê²°ê³¼
        total_time = time.time() - start_time

        print(f"\n\nğŸ“Š ìˆ˜ì§‘ ì™„ë£Œ!")
        print(f"ğŸ™ï¸ ì²˜ë¦¬ ì™„ë£Œ: {current_count}ê°œ ê¸°ì´ˆìì¹˜ë‹¨ì²´")
        print(f"ğŸ¢ ì´ ë§¤ë¬¼ ìˆ˜: {len(all_rooms):,}ê°œ")
        print(f"ğŸ“‹ ë°œê²¬ëœ í•„ë“œ ìˆ˜: {len(crawler.all_fields_discovered)}ê°œ")
        print(f"â° ì´ ì†Œìš”ì‹œê°„: {int(total_time//60):02d}:{int(total_time%60):02d}")

        # ì‹¤íŒ¨í•œ ì§€ì—­ ë³´ê³ 
        if crawler.failed_areas:
            print(f"\nâš ï¸ ì‹¤íŒ¨í•œ ì§€ì—­ ({len(crawler.failed_areas)}ê°œ):")
            for failed_area in crawler.failed_areas:
                print(f"  - {failed_area}")

        # ì§€ì—­ë³„ í†µê³„
        region_stats = {}
        for room in all_rooms:
            region = room.get("region_name", "Unknown")
            region_stats[region] = region_stats.get(region, 0) + 1

        print(f"\nğŸ“ˆ ì§€ì—­ë³„ ë§¤ë¬¼ ìˆ˜:")
        for region, count in sorted(
            region_stats.items(), key=lambda x: x[1], reverse=True
        ):
            if region != "Unknown":
                print(f"  ğŸ“ {region}: {count:,}ê°œ")

        # ìµœì¢… ì €ì¥
        save_results_complete(all_rooms)

        # ë°œê²¬ëœ ì£¼ìš” í•„ë“œ ì¶œë ¥
        if crawler.all_fields_discovered:
            print(f"\nğŸ“‹ ë°œê²¬ëœ ì£¼ìš” í•„ë“œ (ìƒìœ„ 20ê°œ):")
            sorted_fields = sorted(list(crawler.all_fields_discovered))
            for i, field in enumerate(sorted_fields[:20], 1):
                print(f"  {i:2d}. {field}")

            if len(sorted_fields) > 20:
                print(f"  ... ë° {len(sorted_fields) - 20}ê°œ ì¶”ê°€ í•„ë“œ")

    except KeyboardInterrupt:
        print("\nâ¹ï¸ í¬ë¡¤ë§ ì¤‘ë‹¨")
    except Exception as e:
        print(f"\nâŒ ì˜¤ë¥˜: {e}")
        import traceback

        traceback.print_exc()
    finally:
        print("\nğŸ”§ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì¤‘...")
        crawler.close()
        print("âœ… í¬ë¡¤ë§ ì™„ë£Œ!")


if __name__ == "__main__":
    main()
